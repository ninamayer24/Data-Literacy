{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "043fb08f",
   "metadata": {},
   "source": [
    "#### Merging the datasets\n",
    "\n",
    "The script merges the bridge dataset with the GDP data and population density. To do this, two new columns are added to the bridge dataset.\n",
    "- `GDP`\n",
    "- `population density`"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "7d6c93e9-272e-47ac-979f-5856a071bee7",
   "metadata": {},
   "outputs": [],
   "source": [
    "# load libaries\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import openpyxl as op\n",
    "import seaborn as sns\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "2ba41acc-b7f6-4735-88c5-6917164b53ce",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/ines/miniconda3/lib/python3.12/site-packages/openpyxl/reader/workbook.py:118: UserWarning: Print area cannot be set to Defined name: Inhalt!$A:$H.\n",
      "  warn(f\"Print area cannot be set to Defined name: {defn.value}.\")\n"
     ]
    }
   ],
   "source": [
    "# read data\n",
    "data_bridges = pd.read_csv('./filled_bridge_statistic_germany.csv', sep=';')\n",
    "data_gdp = pd.read_excel(\"./BIP_Dataset.xlsx\", sheet_name= \"1.1\", skiprows= 4)\n",
    "data_population = pd.read_excel(\"./Datenset_Bevölkerung.xlsx\", sheet_name= \"Kreisfreie Städte u. Landkreise\", skiprows= 1)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "49bebd0d",
   "metadata": {},
   "source": [
    "Because we want to look at the \"Kreise\", we deleat the \"Bundesländer\" that they won't falsify the data. Later we will merge different cities when they are \"Kreis\" and \"Stadt\" and deleat the lable to make one \"Kreis\" out of to simplify it. In addition all other rows which doesnt't contain a velue in the column \"Kreis\" will be deleted."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "21a26f9b",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "# Copy data to modify it\n",
    "data_gdp_modified = data_gdp.copy()\n",
    "data_population_modified = data_population.copy()\n",
    "\n",
    "\n",
    "# Deleating rows without an entery in NUTS 3 (Kreisebene)\n",
    "data_gdp_modified = data_gdp_modified[\n",
    "    data_gdp_modified['NUTS 3'].notna() & (data_gdp_modified['NUTS 3'] != '')\n",
    "]\n",
    "\n",
    "data_population_modified = data_population_modified[\n",
    "    data_population_modified['NUTS3'].notna() & (data_population_modified['NUTS3'] != '')\n",
    "]\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dd2260c0",
   "metadata": {},
   "source": [
    "Because the names of the GDP dataset amd the population density dataset differ, we normalise the names of the \"Kreise\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c8742ffd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Anzahl Kreise: 403\n",
      "Flensburg: 96326\n",
      "Kiel: 252668\n",
      "Luebeck: 216889\n",
      "Neumuenster: 79809\n",
      "Dithmarschen: 133460\n",
      "Herzogtum Lauenburg: 206235\n",
      "Nordfriesland: 170029\n",
      "Ostholstein: 201472\n",
      "Pinneberg: 325223\n",
      "Ploen: 130609\n",
      "Rendsburg-Eckernfoerde: 278058\n",
      "Schleswig-Flensburg: 205472\n",
      "Segeberg: 283562\n",
      "Steinburg: 132731\n",
      "Stormarn: 246974\n",
      "Hamburg: 1862565\n",
      "Braunschweig: 252962\n",
      "Salzgitter: 104970\n",
      "Wolfsburg: 129560\n",
      "Gifhorn: 175943\n",
      "Goslar: 126775\n",
      "Helmstedt: 90227\n",
      "Northeim: 125623\n",
      "Peine: 137045\n",
      "Wolfenbuettel: 118290\n",
      "Goettingen: 328028\n",
      "Hannover: 1140888\n",
      "Diepholz: 221202\n",
      "Hameln-Pyrmont: 150203\n",
      "Hildesheim: 267506\n",
      "Holzminden: 65581\n",
      "Nienburg: 121468\n",
      "Schaumburg: 156841\n",
      "Celle: 172449\n",
      "Cuxhaven: 198842\n",
      "Harburg: 265864\n",
      "Luechow-Dannenberg: 46502\n",
      "Lueneburg: 179448\n",
      "Osterholz: 113598\n",
      "Rotenburg: 165904\n",
      "Heidekreis: 141321\n",
      "Stade: 207700\n",
      "Uelzen: 91638\n",
      "Verden: 138626\n",
      "Delmenhorst: 81406\n",
      "Emden: 49202\n",
      "Oldenburg: 176614\n",
      "Osnabrueck: 166057\n",
      "Wilhelmshaven: 75745\n",
      "Ammerland: 127751\n",
      "Aurich: 188816\n",
      "Cloppenburg: 177025\n",
      "Emsland: 334539\n",
      "Friesland: 100411\n",
      "Grafschaft Bentheim: 144543\n",
      "Leer: 169103\n",
      "Oldenburg: 132008\n",
      "Osnabrueck: 354821\n",
      "Vechta: 146539\n",
      "Wesermarsch: 88936\n",
      "Wittmund: 55969\n",
      "Bremen: 586271\n",
      "Bremerhaven: 118610\n",
      "Duesseldorf: 618685\n",
      "Duisburg: 502270\n",
      "Essen: 574682\n",
      "Krefeld: 231406\n",
      "Moenchengladbach: 267213\n",
      "Muelheim An Der Ruhr: 173050\n",
      "Oberhausen: 213646\n",
      "Remscheid: 113828\n",
      "Solingen: 165626\n",
      "Wuppertal: 358193\n",
      "Kleve: 322018\n",
      "Mettmann: 490910\n",
      "Rhein-Kreis Neuss: 457077\n",
      "Viersen: 297857\n",
      "Wesel: 457918\n",
      "Bonn: 323336\n",
      "Koeln: 1024621\n",
      "Leverkusen: 168581\n",
      "Aachen: 582410\n",
      "Dueren: 279285\n",
      "Rhein-Erft-Kreis: 477988\n",
      "Euskirchen: 202609\n",
      "Heinsberg: 263681\n",
      "Oberbergischer: 274057\n",
      "Rheinisch-Bergischer: 284273\n",
      "Rhein-Sieg-Kreis: 605441\n",
      "Bottrop: 118535\n",
      "Gelsenkirchen: 267930\n",
      "Muenster: 308258\n",
      "Borken: 380796\n",
      "Coesfeld: 227859\n",
      "Recklinghausen: 621305\n",
      "Steinfurt: 451712\n",
      "Warendorf: 282639\n",
      "Bielefeld: 331605\n",
      "Guetersloh: 363982\n",
      "Herford: 254404\n",
      "Hoexter: 139252\n",
      "Lippe: 347149\n",
      "Minden-Luebbecke: 320557\n",
      "Paderborn: 315912\n",
      "Bochum: 358676\n",
      "Dortmund: 603462\n",
      "Hagen: 190384\n",
      "Hamm: 179968\n",
      "Herne: 155851\n",
      "Ennepe-Ruhr-Kreis: 314167\n",
      "Hochsauerlandkreis: 260843\n",
      "Maerkischer: 408046\n",
      "Olpe: 132346\n",
      "Siegen-Wittgenstein: 274074\n",
      "Soest: 300297\n",
      "Unna: 393784\n",
      "Darmstadt: 167029\n",
      "Frankfurt Am Main: 756021\n",
      "Offenbach Am Main: 132746\n",
      "Wiesbaden: 288850\n",
      "Bergstrasse: 274169\n",
      "Darmstadt-Dieburg: 302021\n",
      "Gross-Gerau: 268310\n",
      "Hochtaunuskreis: 241664\n",
      "Main-Kinzig-Kreis: 420914\n",
      "Main-Taunus-Kreis: 238775\n",
      "Odenwaldkreis: 93846\n",
      "Offenbach: 358022\n",
      "Rheingau-Taunus-Kreis: 185651\n",
      "Wetteraukreis: 311593\n",
      "Giessen: 268418\n",
      "Lahn-Dill-Kreis: 254074\n",
      "Limburg-Weilburg: 173830\n",
      "Marburg-Biedenkopf: 242805\n",
      "Vogelsbergkreis: 101163\n",
      "Kassel Documenta-: 197230\n",
      "Fulda: 222283\n",
      "Hersfeld-Rotenburg: 117414\n",
      "Kassel: 231073\n",
      "Schwalm-Eder-Kreis: 180071\n",
      "Waldeck-Frankenberg: 155126\n",
      "Werra-Meissner-Kreis: 97695\n",
      "Koblenz: 113378\n",
      "Ahrweiler: 129353\n",
      "Altenkirchen: 132125\n",
      "Bad Kreuznach: 164748\n",
      "Birkenfeld: 82611\n",
      "Cochem-Zell: 61608\n",
      "Mayen-Koblenz: 217228\n",
      "Neuwied: 189061\n",
      "Rhein-Hunsrueck-Kreis: 106705\n",
      "Rhein-Lahn-Kreis: 125588\n",
      "Westerwaldkreis: 207803\n",
      "Trier: 104342\n",
      "Bernkastel-Wittlich: 113187\n",
      "Eifelkreis Bitburg-Pruem: 99788\n",
      "Vulkaneifel: 59313\n",
      "Trier-Saarburg: 148953\n",
      "Frankenthal: 48140\n",
      "Kaiserslautern: 100426\n",
      "Landau: 48209\n",
      "Ludwigshafen: 177222\n",
      "Mainz: 224684\n",
      "Neustadt An Der Weinstrasse: 52945\n",
      "Pirmasens: 39761\n",
      "Speyer: 49564\n",
      "Worms: 86753\n",
      "Zweibruecken: 33323\n",
      "Alzey-Worms: 131238\n",
      "Bad Duerkheim: 134329\n",
      "Donnersbergkreis: 74783\n",
      "Germersheim: 131383\n",
      "Kaiserslautern: 106343\n",
      "Kusel: 69334\n",
      "Suedliche Weinstrasse: 113031\n",
      "Rhein-Pfalz-Kreis: 155882\n",
      "Mainz-Bingen: 206454\n",
      "Suedwestpfalz: 89974\n",
      "Stuttgart: 612663\n",
      "Boeblingen: 395167\n",
      "Esslingen: 536601\n",
      "Goeppingen: 258809\n",
      "Ludwigsburg: 535374\n",
      "Rems-Murr-Kreis: 440696\n",
      "Heilbronn: 131986\n",
      "Heilbronn: 353877\n",
      "Hohenlohekreis: 115644\n",
      "Schwaebisch Hall: 200902\n",
      "Main-Tauber-Kreis: 133169\n",
      "Heidenheim: 135235\n",
      "Ostalb: 317427\n",
      "Baden-Baden: 56881\n",
      "Karlsruhe: 309050\n",
      "Karlsruhe: 456264\n",
      "Rastatt: 230737\n",
      "Heidelberg: 155756\n",
      "Mannheim: 318035\n",
      "Neckar-Odenwald-Kreis: 145263\n",
      "Rhein-Neckar-Kreis: 558561\n",
      "Pforzheim: 134912\n",
      "Calw: 161251\n",
      "Enzkreis: 199745\n",
      "Freudenstadt: 121958\n",
      "Freiburg: 237460\n",
      "Breisgau-Hochschwarzwald: 272558\n",
      "Emmendingen: 169787\n",
      "Ortenaukreis: 444858\n",
      "Rottweil: 140237\n",
      "Schwarzwald-Baar-Kreis: 214065\n",
      "Tuttlingen: 145208\n",
      "Konstanz: 291841\n",
      "Loerrach: 238263\n",
      "Waldshut: 171579\n",
      "Reutlingen: 293483\n",
      "Tuebingen: 233546\n",
      "Zollernalbkreis: 193326\n",
      "Ulm: 129882\n",
      "Alb-Donau-Kreis: 202354\n",
      "Biberach: 207415\n",
      "Bodenseekreis: 220804\n",
      "Ravensburg: 291102\n",
      "Sigmaringen: 132167\n",
      "Ingolstadt: 141185\n",
      "Muenchen: 1505005\n",
      "Rosenheim: 65274\n",
      "Altoetting: 113938\n",
      "Berchtesgadener Land: 105292\n",
      "Bad Toelz-Wolfratshausen: 130248\n",
      "Dachau: 153595\n",
      "Ebersberg: 144225\n",
      "Eichstaett: 135668\n",
      "Erding: 140127\n",
      "Freising: 184564\n",
      "Fuerstenfeldbruck: 218227\n",
      "Garmisch-Partenkirchen: 89296\n",
      "Landsberg Am Lech: 122107\n",
      "Miesbach: 97152\n",
      "Muehldorf Ainn: 122037\n",
      "Muenchen: 354396\n",
      "Neuburg-Schrobenhausen: 99364\n",
      "Pfaffenhofen Adilm: 130781\n",
      "Rosenheim: 258637\n",
      "Starnberg: 139329\n",
      "Traunstein: 175144\n",
      "Weilheim-Schongau: 138957\n",
      "Landshut: 71863\n",
      "Passau: 53039\n",
      "Straubing: 49002\n",
      "Deggendorf: 121844\n",
      "Freyung-Grafenau: 78710\n",
      "Kelheim: 126037\n",
      "Landshut: 162170\n",
      "Passau: 194699\n",
      "Regen: 77267\n",
      "Rottal-Inn: 120497\n",
      "Straubing-Bogen: 103041\n",
      "Dingolfing-Landau: 101035\n",
      "Amberg: 42553\n",
      "Regensburg: 151389\n",
      "Weiden Idopf: 42444\n",
      "Amberg-Sulzbach: 103982\n",
      "Cham: 128534\n",
      "Neumarkt Idopf: 138693\n",
      "Neustadt Adwaldnaab: 96049\n",
      "Regensburg: 196213\n",
      "Schwandorf: 149312\n",
      "Tirschenreuth: 72210\n",
      "Bamberg: 77150\n",
      "Bayreuth: 72940\n",
      "Coburg: 41064\n",
      "Hof: 46778\n",
      "Bamberg: 147777\n",
      "Bayreuth: 103215\n",
      "Coburg: 84468\n",
      "Forchheim: 116184\n",
      "Hof: 92191\n",
      "Kronach: 64545\n",
      "Kulmbach: 71518\n",
      "Lichtenfels: 67379\n",
      "Wunsiedel Ifichtelgebirge: 70549\n",
      "Mittelfranken: nan\n",
      "Ansbach: 40742\n",
      "Erlangen: 115928\n",
      "Fuerth: 132036\n",
      "Nuernberg: 529508\n",
      "Schwabach: 40835\n",
      "Ansbach: 187633\n",
      "Erlangen-Hoechstadt: 138325\n",
      "Fuerth: 117719\n",
      "Nuernberger Land: 168813\n",
      "Neustadt Ad Aisch-Bad Windsheim: 101043\n",
      "Roth: 128632\n",
      "Weissenburg-Gunzenhausen: 94695\n",
      "Unterfranken: nan\n",
      "Aschaffenburg: 73091\n",
      "Schweinfurt: 54481\n",
      "Wuerzburg: 133258\n",
      "Aschaffenburg: 170945\n",
      "Bad Kissingen: 103489\n",
      "Rhoen-Grabfeld: 79375\n",
      "Hassberge: 83869\n",
      "Kitzingen: 91287\n",
      "Miltenberg: 127547\n",
      "Main-Spessart: 125282\n",
      "Schweinfurt: 113977\n",
      "Wuerzburg: 162216\n",
      "Schwaben: nan\n",
      "Augsburg: 301105\n",
      "Kaufbeuren: 46193\n",
      "Kempten: 67645\n",
      "Memmingen: 44192\n",
      "Aichach-Friedberg: 136803\n",
      "Augsburg: 262811\n",
      "Dillingen Addonau: 98899\n",
      "Guenzburg: 129846\n",
      "Neu-Ulm: 183595\n",
      "Lindau: 82411\n",
      "Ostallgaeu: 142047\n",
      "Unterallgaeu: 147255\n",
      "Donau-Ries: 135098\n",
      "Oberallgaeu: 155413\n",
      "Saarbruecken: 333149\n",
      "Merzig-Wadern: 108779\n",
      "Neunkirchen: 133179\n",
      "Saarlouis: 205129\n",
      "Saarpfalz-Kreis: 144092\n",
      "St Wendel: 87813\n",
      "Berlin: 3685265\n",
      "Brandenburg An Der Havel: 74113\n",
      "Cottbus: 95123\n",
      "Frankfurt: 57107\n",
      "Potsdam: 184754\n",
      "Barnim: 194169\n",
      "Dahme-Spreewald: 178793\n",
      "Elbe-Elster: 97967\n",
      "Havelland: 170834\n",
      "Maerkisch-Oderland: 197817\n",
      "Oberhavel: 217690\n",
      "Oberspreewald-Lausitz: 107793\n",
      "Oder-Spree: 179817\n",
      "Ostprignitz-Ruppin: 99152\n",
      "Potsdam-Mittelmark: 221268\n",
      "Prignitz: 75595\n",
      "Spree-Neisse: 109635\n",
      "Teltow-Flaeming: 177688\n",
      "Uckermark: 117432\n",
      "Rostock: 205307\n",
      "Schwerin: 98308\n",
      "Mecklenburgische Seenplatte: 246318\n",
      "Rostock: 218721\n",
      "Vorpommern-Ruegen: 215203\n",
      "Nordwestmecklenburg: 156692\n",
      "Vorpommern-Greifswald: 224956\n",
      "Ludwigslust-Parchim: 208092\n",
      "Chemnitz: 245618\n",
      "Erzgebirgskreis: 318394\n",
      "Mittelsachsen: 296431\n",
      "Vogtlandkreis: 219100\n",
      "Zwickau: 306793\n",
      "Dresden: 564904\n",
      "Bautzen: 292608\n",
      "Goerlitz: 243958\n",
      "Meissen: 239221\n",
      "Saechsische Schweiz-Osterzgebirge: 243996\n",
      "Leipzig: 611850\n",
      "Leipzig: 260127\n",
      "Nordsachsen: 199422\n",
      "Dessau-Rosslau: 75402\n",
      "Halle: 226767\n",
      "Magdeburg: 244329\n",
      "Altmarkkreis Salzwedel: 79980\n",
      "Anhalt-Bitterfeld: 153035\n",
      "Boerde: 167924\n",
      "Burgenlandkreis: 173684\n",
      "Harz: 205484\n",
      "Jerichower Land: 88509\n",
      "Mansfeld-Suedharz: 129029\n",
      "Saalekreis: 182451\n",
      "Salzlandkreis: 180771\n",
      "Stendal: 106538\n",
      "Wittenberg: 121694\n",
      "Erfurt: 218793\n",
      "Gera: 95608\n",
      "Jena: 109725\n",
      "Suhl: 34685\n",
      "Weimar: 65954\n",
      "Eichsfeld: 103694\n",
      "Nordhausen: 80762\n",
      "Wartburgkreis: 154957\n",
      "Unstrut-Hainich-Kreis: 94613\n",
      "Kyffhaeuserkreis: 71738\n",
      "Schmalkalden-Meiningen: 120214\n",
      "Gotha: 135838\n",
      "Soemmerda: 67693\n",
      "Hildburghausen: 59987\n",
      "Ilm-Kreis: 106657\n",
      "Weimarer Land: 82392\n",
      "Sonneberg: 54964\n",
      "Saalfeld-Rudolstadt: 100105\n",
      "Saale-Holzland-Kreis: 83342\n",
      "Saale-Orla-Kreis: 77341\n",
      "Greiz: 93707\n",
      "Altenburg: 87508\n"
     ]
    }
   ],
   "source": [
    "# normalise names\n",
    "\n",
    "def normalize_name(name):\n",
    "    # in lowercase letters\n",
    "    name = name.lower()\n",
    "    # remove space around hyphen\n",
    "    name = re.sub(r'\\s*-\\s*', '-', name)\n",
    "    # remove commas and full stops\n",
    "    name = name.replace(',', '')\n",
    "    name = name.replace('.', '')\n",
    "    # remove special keywords\n",
    "    name = re.sub(r'\\b(landkreis|kreisfreie stadt|stadt|regierungsbezirk|universitätsstadt|wissenschaftsstadt|landeshauptstadt|reg-bez|region|kfr|hansestadt|stadtkreis|klingenstadt|freie und hansestadt|städteregion|regionalverband|im breisgau)\\b', '', name)\n",
    "    name = re.sub(r'(?<!-)\\bkreis\\b', '', name) # kreis nur wenn es allein steht\n",
    "    # umlaute\n",
    "    name = re.sub('ä', 'ae', name)\n",
    "    name = re.sub('ü', 'ue', name)\n",
    "    name = re.sub('ö', 'oe', name)\n",
    "    # correct spelling\n",
    "    name = re.sub('ß','ss', name)\n",
    "    # remove bracket additions\n",
    "    name = re.sub(r'\\([^)]*\\)', '', name)\n",
    "    # remove leading/trailing spaces\n",
    "    name = name.strip()\n",
    "    # reduce multiple space character to one\n",
    "    name = re.sub(r'\\s+', ' ', name)\n",
    "    # special cases\n",
    "    name = re.sub('ludwigshafen am rhein', 'ludwigshafen', name)\n",
    "    name = re.sub('neustadt/weinstrasse','neustadt an der weinstrasse', name)\n",
    "    name = re.sub ('frankfurt main', 'frankfurt am main', name)\n",
    "    name = re.sub ('hagen der fernuniversitaet', 'hagen', name)\n",
    "    name = re.sub ('ostalbkreis', 'ostalb' , name)\n",
    "    name = re.sub ('neustadt adaisch-bad windsheim', 'neustadt ad aisch-bad windsheim', name)\n",
    "    name = re.sub ('landau in der pfalz', 'Landau', name)\n",
    "    name = re.sub ('altenburger land', 'altenburg', name)\n",
    "\n",
    "    return name\n",
    "\n",
    "# Normalisation on the datasets\n",
    "data_population_modified['Kreisfreie Städte und Landkreise'] = data_population_modified['Kreisfreie Städte und Landkreise'].apply(normalize_name)\n",
    "data_gdp_modified['Gebietseinheit'] = data_gdp_modified['Gebietseinheit'].apply(normalize_name)\n",
    "\n",
    "# Capital letters for the first letter of the words\n",
    "data_gdp_modified['Gebietseinheit'] = data_gdp_modified['Gebietseinheit'].str.title()\n",
    "data_population_modified['Kreisfreie Städte und Landkreise'] = data_population_modified['Kreisfreie Städte und Landkreise'].str.title()\n",
    "\n",
    "print(\"Anzahl Kreise:\", len(data_population_modified))\n",
    "\n",
    "for index, row in data_population_modified.iterrows():\n",
    "    print(f\"{row['Kreisfreie Städte und Landkreise']}: {row['Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ insgesamt']}\")\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ae0ce87a",
   "metadata": {},
   "source": [
    "Because some cities occur more then once (because we deleted labels like \"Kreis\" and \"Landkreis\") we have to merge those rows."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1ace2db9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Karlsruhe: 765314\n"
     ]
    }
   ],
   "source": [
    "# Merge data of cities with the same name due to normalisation. (Kassel Kreis, Kassel Landkreis)\n",
    "# Merge population\n",
    "\n",
    "columns_to_sum = [\n",
    "    ' Fläche km² ¹⁾',\n",
    "    'Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ insgesamt',\n",
    "    'Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ männlich',\n",
    "    'Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ weiblich',\n",
    "    'Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ je km²'\n",
    "]\n",
    "\n",
    "# Group by 'Kreis' and sum all numeric columns\n",
    "data_population_cleaned = data_population_modified.groupby('Kreisfreie Städte und Landkreise', as_index=False)[columns_to_sum].sum()\n",
    "\n",
    "# Merge GDP\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1e6094a9",
   "metadata": {},
   "source": [
    "Because there are some mistakes in the 'Kreis' column in the bridges dataset we have to prepare it before merging. For example, the 'Landkreis Eisenach' became part of the 'Wartburgkreis'."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "84cf6ef2",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Preparing the bridges dataset\n",
    "\n",
    "data_bridges_original = data_bridges.copy()\n",
    "data_bridges_original['Kreis'] = data_bridges_original['Kreis'].apply(normalize_name)\n",
    "data_bridges_original['Kreis'] = data_bridges_original['Kreis'].str.title()\n",
    "\n",
    "# Rename 'Eisenach' to 'Wartburgkreis' because since 2022 it doesn't exist anymore\n",
    "data_bridges_original['Kreis'] = data_bridges_original['Kreis'].replace({\n",
    "    'Eisenach': 'Wartburgkreis'\n",
    "})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d9d9ea2d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Niedersachsen: nan\n",
      "Niedersachsen: nan\n",
      "Niedersachsen: nan\n",
      "Niedersachsen: nan\n",
      "Niedersachsen: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Saarland: nan\n",
      "Mecklenburg Vorpommern: nan\n",
      "Mecklenburg Vorpommern: nan\n",
      "Mecklenburg Vorpommern: nan\n",
      "Nrw: nan\n",
      "Nrw: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n",
      "Bundesrepublik Deutschland: nan\n"
     ]
    }
   ],
   "source": [
    "\n",
    "# Merging population\n",
    "data_bridges_merged = data_bridges_original.merge(\n",
    "    data_population_cleaned[['Kreisfreie Städte und Landkreise', 'Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ insgesamt']],  # nur relevante Spalten übernehmen\n",
    "    left_on='Kreis',                                                        # Spalte im Hauptdatensatz\n",
    "    right_on= 'Kreisfreie Städte und Landkreise',                         # Spalte im Populationsdatensatz\n",
    "    how='left'                                                          # alle Zeilen in data_main behalten\n",
    ")\n",
    "\n",
    "# delete 'Kreisfreie Städte und Landkreise' out of data_bridges_merged because it doubles with 'Kreis'\n",
    "data_bridges_merged = data_bridges_merged.drop(columns=['Kreisfreie Städte und Landkreise'])\n",
    "\n",
    "# check in whitch 'Kreis' is no match with population\n",
    "for index, row in data_bridges_merged.iterrows():\n",
    "    if pd.isna(row['Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ insgesamt']):\n",
    "        print(f\"{row['Kreis']}: {row['Bevölkerung auf Grundlage des ZENSUS 2022 ²⁾ insgesamt']}\")\n",
    "\n",
    "# Merging GDP\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "base",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
